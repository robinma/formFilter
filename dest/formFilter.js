!function(a,b){"function"==typeof define&&(define.cmd||define.amd)?define(function(){return b()}):a.formFilter=b()}(this,function(){function Field(a){$.extend({require:!1},a),this.params=a,this.config=a.config,this.el=a.el,this.$el=a.$el,this.callback=this.config.callback||function(){},this.ruleStatus={},this.checked=!1,this._interrupt=!1,this._init()}var formFilter=function(){var a,b,c=arguments,d=c.length;d>=2?(b=c[0],a=c[1]):1==d&&(b="body",a=c[0]),this.$el="object"==typeof b?b:$(b),a=a||{},this.fieldArr=[],this.fieldObj={},this._init(a)};$.extend(formFilter.prototype,{},{version:"0.0.1",_init:function(a){"object"==typeof a&&this._traversal(a)},_traversal:function(a){var b=this,c=0;$.each(a,function(a,d){var e=new Field({el:a.replace(/^\s*|\s*$/gi,""),$el:b.get$Obj(a),config:d,groupField:b.fieldObj});b.fieldObj[a]=e,b.fieldArr.push(e),c++}),b.fieldLength=c},get$Obj:function(a){return this.$el.find(a)},check:function(){var a=this,b=0;return $.each(a.fieldObj,function(a,c){c.checked||b++}),!b},serialize:function(){var a=this,b=[];return $.each(a.fieldObj,function(a,c){var d={};d[c.getFieldName()]=c.getData(),b.push(d)}),b},submit:function(a){var b=this,c=0,d=function(){a(!b.check(),b.serialize())},e=function(a){var f=b.fieldArr[a];f.todoRule(function(){return c++,c>=b.fieldLength?void d():void e(c)})};e(c)}});var ruleStr=["ff-length","ff-exp","ff-equal","ff-remote"];$.extend(Field.prototype,{},{_init:function(){this.rules=this._extRule(),this.emitEvn()},_extRule:function(){var a=this,b=[];return $.each(ruleStr,function(c,d){var e={},f=a.$el.attr(d);f=$.trim(f),f.length>0&&(e[d]=f);var g=a.config[d];if(g&&(e[d]=g),!$.isEmptyObject(e))for(var h in e)b.push([h,e[h]])}),b},getData:function(){return this.$el.val().replace(/$\s*|\s*$/gi,"")},getFieldName:function(){return this.$el.attr("name")},emitEvn:function(){var a=this;this.$el.on("blur",function(){a.todoRule()})},todoRule:function(a){var b=this,c=b.rules,d=c.length,e=0,f=b.getData();if(!b.config.require&&!f)return void(a&&a());var g=function(f){var h=c[f];b.distRule(h[0],h[1],function(c,f,h){var i=b.fieldVerify(c,f,h);return++e>=d?void(a&&a()):void(i?g(e):d>e&&a&&a())})};g(e)},fieldVerify:function(a,b,c){var d=this,e=d.rules,f=0,g=0;if(d.ruleStatus[b]=a,a)return d.callback(!0,c.tips,d),d.checked=!1,!1;for(var h=0,i=e.length;i>h;h++){var j=d.ruleStatus[e[h][0]];"boolean"!=typeof j||j!==!1?g+=1:f+=1}return f!=e.length&&d._interrupt||(d.callback(!1,c.tips,d),d.checked=!0),!0},distRule:function(a,b,c){var d,e=this;a==ruleStr[0]?d=new lengthVer(b):a==ruleStr[1]?d=new verRepExp(b):a==ruleStr[2]?d=new verEqual(b,e):a==ruleStr[3]&&(d=new verRemote(b,e)),e.set_callback(d,a,c)},set_callback:function(a,b,c){var d=this;return a.callback=function(e){e?(d._interrupt=!0,c.call(d,!0,b,a)):(d._interrupt=!1,c.call(d,!1,b,a))},a.valiData(d.getData())}});var lengthVer=function(a){var b,c=$.type(a);"array"==c?b=a:"string"==c&&(b=a.split(",")),this.tips="",this.valArr=b,this.callback=null};lengthVer.prototype.valiData=function(a){var b=this.valArr;b.length>=2?this.tips=b[2]?b[2]:"":1==b.length&&(b[1]=b[0]);var c=new RegExp("^.{"+b[0]+","+b[1]+"}$");return c.test(a)?(this.callback(!1),!0):(this.callback(!0),!1)};var verRepExp=function(regStr){var strType=$.type(regStr),regArr=null;"array"==strType?regArr=regStr:"string"==strType&&(regArr=eval("("+regStr+")")),this.tips=regArr[1],this.callback=null,this.regstr=regArr[0]};verRepExp.prototype.valiData=function(a){var b=this.regstr;return b.test(a)?(this.callback(!1),!0):(this.callback(!0),!1)};var verEqual=function(regStr,field){var strType=$.type(regStr),regArr=null;"array"==strType?regArr=regStr:"string"==strType&&(regArr=eval("("+regStr+")"));var groups=field.params.groupField;this.relFeld=groups[regArr[0]],this.tips=regArr[1]?regArr[1]:"",this.callback=null};verEqual.prototype.valiData=function(a){var b=this.relFeld.getData();return b!==a?(this.callback(!0),!1):(this.callback(!1),!0)};var verRemote=function(remoteparam,field){var strType=$.type(remoteparam),regArr=null;"array"==strType?regArr=remoteparam:"string"==strType&&(regArr=eval("("+remoteparam+")")),this.remote=regArr[0],this.verFn=regArr[1],this.tips=regArr[2],this.filedName=field.$el.attr("name"),this.callback=null};return verRemote.prototype.valiData=function(a){var b=this,c={};c[b.filedName]=a,$.get(this.remote,c,function(a){b.callback(b.verFn(a)?!1:!0)},"json")},function(){var a=arguments.length;return 0==a?new formFilter({}):1==a?new formFilter(arguments[0]):new formFilter(arguments[0],arguments[1])}});